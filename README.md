# DataBase
**데이터베이스 내용 정리**

<details>
<summary style="font-size:16px ">Oracle Pivot Table 사용 전후 예제</summary>
<div markdown="1">

### Oralce 11g 이전 Pivot 사용 X

```sql
SELECT *
  FROM ( 피벗 대상 쿼리문 )
 PIVOT ( 그룹합수(집계컬럼) FOR 피벗컬럼 IN (피벗컬럼값 AS 별칭 ... )
 
ST AS	-- SALES TARGET
(
	SELECT
		DEALER_NM, DSPY_RANK, 'New Vehicle Sales' CATE1, CATE2, CATE3
		, NVL(SUM(DECODE(MON, '01', SALES_TARGET)),0) AS JAN		
		, NVL(SUM(DECODE(MON, '02', SALES_TARGET)),0) AS FEB
		, NVL(SUM(DECODE(MON, '03', SALES_TARGET)),0) AS MAR
		, NVL(SUM(DECODE(MON, '04', SALES_TARGET)),0) AS APR
		, NVL(SUM(DECODE(MON, '05', SALES_TARGET)),0) AS MAY
		, NVL(SUM(DECODE(MON, '06', SALES_TARGET)),0) AS JUN
		, NVL(SUM(DECODE(MON, '07', SALES_TARGET)),0) AS JUL
		, NVL(SUM(DECODE(MON, '08', SALES_TARGET)),0) AS AUG
		, NVL(SUM(DECODE(MON, '09', SALES_TARGET)),0) AS SEP
		, NVL(SUM(DECODE(MON, '10', SALES_TARGET)),0) AS OCT
		, NVL(SUM(DECODE(MON, '11', SALES_TARGET)),0) AS NOV
		, NVL(SUM(DECODE(MON, '12', SALES_TARGET)),0) AS DEC
		, NVL(SUM(SALES_TARGET),0) AS TOT
	FROM 
	(
		SELECT 
			CASE DEALER_ID WHEN 'DT00000' THEN '렉서스 강남'
					       WHEN 'CW00000' THEN '렉서스 용산'
					       WHEN 'CT00000' THEN '렉서스 분당'
					       WHEN 'SY00000' THEN '렉서스 인천'
					       WHEN 'KM00000' THEN '렉서스 부산'
					       WHEN 'NY00000' THEN '렉서스 광주'
					       WHEN 'YM00000' THEN '렉서스 대구'
					       WHEN 'JB00000' THEN '렉서스 대전' END DEALER_NM,
			TARGET_M MON,
			DSPY_RANK,
			SUM(SALES_TARGET_QTY) SALES_TARGET,
			'Sales(Delivery)' CATE2, 'Target' CATE3
		FROM
		(
			SELECT
				CASE WHEN VMTS.DEALER_ID = 'PM00000' THEN 'DT00000' ELSE VMTS.DEALER_ID END DEALER_ID,
				TO_CHAR(TO_DATE(TARGET_YM, 'YYYYMM'), 'MM') TARGET_M,
				SALES_TARGET_QTY,
				D.DSPY_RANK DSPY_RANK
			FROM
				VT_MONTHLY_TARGET_SHOP VMTS INNER JOIN DEALER D
				ON VMTS.DEALER_ID = D.DEALER_ID
			WHERE 
				SUBSTR(TARGET_YM, 1, 4) = '2023'
		) A
		GROUP BY 
			DEALER_ID, TARGET_M, DSPY_RANK
		UNION 
		SELECT 
			'Total' DEALER_NM,
			TARGET_M MON,
			99 DSPY_RANK,
			SUM(SALES_TARGET_QTY) SALES_TARGET,
			'Sales(Delivery)' CATE2, 'Target' CATE3
		FROM 
		(
			SELECT
				CASE WHEN VMTS.DEALER_ID = 'PM00000' THEN 'DT00000' ELSE VMTS.DEALER_ID END DEALER_ID,
				TO_CHAR(TO_DATE(TARGET_YM, 'YYYYMM'), 'MM') TARGET_M,
				SALES_TARGET_QTY,
				D.DSPY_RANK DSPY_RANK
			FROM
				VT_MONTHLY_TARGET_SHOP VMTS INNER JOIN DEALER D
				ON VMTS.DEALER_ID = D.DEALER_ID
			WHERE 
				SUBSTR(TARGET_YM, 1, 4) = '2023'			
		) A2
		GROUP BY 
			TARGET_M
	) B
	GROUP BY 
		DEALER_NM, DSPY_RANK, CATE2, CATE3
)
```

### Oralce 11g Pivot 사용 O

```sql
ST AS	-- SALES TARGET
(
	SELECT
		DEALER_NM, DSPY_RANK, 'New Vehicle Sales' CATE1, CATE2, CATE3, 
		NVL(JAN,0) JAN,
		NVL(FEB,0) FEB,
		NVL(MAR,0) MAR,
		NVL(APR,0) APR,
		NVL(MAY,0) MAY,
		NVL(JUN,0) JUN,
		NVL(JUL,0) JUL,
		NVL(AUG,0) AUG,
		NVL(SEP,0) SEP,
		NVL(OCT,0) OCT,
		NVL(NOV,0) NOV,
		NVL(DEC,0) DEC,
		NVL(JAN+FEB+MAR+APR+MAY+JUN+JUL+AUG+SEP+OCT+NOV+DEC,0) TOT
	FROM 
	(
		SELECT 
			CASE DEALER_ID WHEN 'DT00000' THEN '렉서스 강남'
					       WHEN 'CW00000' THEN '렉서스 용산'
					       WHEN 'CT00000' THEN '렉서스 분당'
					       WHEN 'SY00000' THEN '렉서스 인천'
					       WHEN 'KM00000' THEN '렉서스 부산'
					       WHEN 'NY00000' THEN '렉서스 광주'
					       WHEN 'YM00000' THEN '렉서스 대구'
					       WHEN 'JB00000' THEN '렉서스 대전' END DEALER_NM,
			TARGET_M MON,
			DSPY_RANK,
			SUM(SALES_TARGET_QTY) SALES_TARGET,
			'Sales(Delivery)' CATE2, 'Target' CATE3
		FROM
		(
			SELECT
				CASE WHEN VMTS.DEALER_ID = 'PM00000' THEN 'DT00000' ELSE VMTS.DEALER_ID END DEALER_ID,
				TO_CHAR(TO_DATE(TARGET_YM, 'YYYYMM'), 'MM') TARGET_M,
				SALES_TARGET_QTY,
				D.DSPY_RANK DSPY_RANK
			FROM
				VT_MONTHLY_TARGET_SHOP VMTS INNER JOIN DEALER D
				ON VMTS.DEALER_ID = D.DEALER_ID
			WHERE 
				SUBSTR(TARGET_YM, 1, 4) = '2023'			
		) A
		GROUP BY 
			DEALER_ID, TARGET_M, DSPY_RANK
		UNION 
		SELECT 
			'Total' DEALER_NM,
			TARGET_M MON,
			99 DSPY_RANK,
			SUM(SALES_TARGET_QTY) SALES_TARGET,
			'Sales(Delivery)' CATE2, 'Target' CATE3
		FROM 
		(
			SELECT
				CASE WHEN VMTS.DEALER_ID = 'PM00000' THEN 'DT00000' ELSE VMTS.DEALER_ID END DEALER_ID,
				TO_CHAR(TO_DATE(TARGET_YM, 'YYYYMM'), 'MM') TARGET_M,
				SALES_TARGET_QTY,
				D.DSPY_RANK DSPY_RANK
			FROM
				VT_MONTHLY_TARGET_SHOP VMTS INNER JOIN DEALER D
				ON VMTS.DEALER_ID = D.DEALER_ID
			WHERE 
				SUBSTR(TARGET_YM, 1, 4) = '2023'			
		) A2
		GROUP BY 
			TARGET_M
	) B
	PIVOT(
			SUM(SALES_TARGET) FOR MON IN (
									'01' AS JAN,
									'02' AS FEB,
									'03' AS MAR,
									'04' AS APR,
									'05' AS MAY,
									'06' AS JUN,
									'07' AS JUL,
									'08' AS AUG,
									'09' AS SEP,
									'10' AS OCT,
									'11' AS NOV,
									'12' AS DEC
									))
)
```

</div>
</details>